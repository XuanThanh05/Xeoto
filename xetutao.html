<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô hình xe 3D</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
        #info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="controls">
            <h3>Điều khiển xe</h3>
            <button onclick="toggleRoof()">Mở/Đóng trần xe</button>
            <button onclick="toggleDoors()">Mở/Đóng cửa xe</button>
            <button onclick="resetView()">Xem toàn bộ xe</button>
        </div>
        <div id="info">
            <p>Kéo chuột để xoay | Cuộn chuột để zoom </p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, car, roof, doors = [], wheels = [];
        let roofOpen = false, doorsOpen = false;
        let mouseX = 0, mouseY = 0;
        let isMouseDown = false;

        function init() {
            // Tạo scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            // Tạo camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(8, 6, 8);
            camera.lookAt(0, 0, 0);

            // Tạo renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);

            // Tạo ánh sáng
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(8,8,10);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 1024
            directionalLight.shadow.mapSize.height = 1024;
            scene.add(directionalLight);

            // Tạo sàn
            const floorGeometry = new THREE.PlaneGeometry(50, 50);
            const floorMaterial = new THREE.MeshLambertMaterial({ color: 0x808080 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = 0;
            floor.receiveShadow = true;
            scene.add(floor);

            // Tạo xe
            createCar();
            // Tạo hệ trục tọa độ với chiều dài mỗi trục là 5 đơn vị
const axesHelper = new THREE.AxesHelper(5);

// Thêm vào scene
scene.add(axesHelper);
            // Thêm event listeners
            addEventListeners();

            // Bắt đầu animation loop
            animate();
        }

        function createCar() {
            car = new THREE.Group();

            // Tạo thân xe chính
            const bodyGeometry = new THREE.BoxGeometry(5, 0.1,10);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x0066cc });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 1;
            body.castShadow = true;
            body.receiveShadow = true;
            car.add(body);

            // Tạo headcabin (phần đầu xe)
            const cabinshape = new THREE.BoxGeometry(5, 1.5, 3.6);
            const headcabin = new THREE.Mesh(cabinshape, bodyMaterial);
            headcabin.position.set(0, 1.7, 4.6);
            headcabin.castShadow = true;
            headcabin.receiveShadow = true;
            car.add(headcabin);
            // Tạo tailcabin (phần đuôi xe)
            const tailcabin = new THREE.Mesh(cabinshape, bodyMaterial);
            tailcabin.position.set(0, 1.7, -4);
            tailcabin.castShadow = true;
            tailcabin.receiveShadow = true;
            car.add(tailcabin);
            // Tạo trần xe (có thể mở)
            createkhungxe();
            // Tạo cửa xe
            createDoors();

            // Tạo bánh xe
            createWheels();

            // Tạo gương
            createMirrors();

            // Tạo đèn pha
            createHeadlights();

            // Tạo nội thất
            createInterior();

            // Tạo kính chắn gió
            createWindshield();

            createLicencePlate();
            scene.add(car);
        }
        function createkhungxe(){
             const khungxeGroup = new THREE.Group();
        }
        function createDoors() {
            const doorGroup = new THREE.Group();

            // Vật liệu phần thân cửa
            const doorMaterial = new THREE.MeshPhongMaterial({ color: 0x0066cc });

            // Vật liệu phần kính cửa (trong suốt nhẹ)
            const glassMaterial = new THREE.MeshPhongMaterial({
                color: 0x99ccff,
                transparent: true,
                opacity: 0.6
            });

            // Kích thước phần dưới và phần trên
            const lowerDoorGeometry = new THREE.BoxGeometry(0.1, 1.5, 1.6); // thân dưới
            const upperDoorGeometry = new THREE.BoxGeometry(0.1, 1.3, 1.6); // kính trên

            // === Cửa trái trên ===
            // Thân dưới
            const leftLowerDoor = new THREE.Mesh(lowerDoorGeometry, doorMaterial);
            leftLowerDoor.position.set(-2.4, 1.75, 1.1);
            leftLowerDoor.castShadow = true;
            doorGroup.add(leftLowerDoor);

            // Kính trên
            const leftUpperDoor = new THREE.Mesh(upperDoorGeometry, glassMaterial);
            leftUpperDoor.position.set(-2.4, 3.15, 1.1);
            doorGroup.add(leftUpperDoor);

            // === Cửa phải trên===
            const rightLowerDoor = new THREE.Mesh(lowerDoorGeometry, doorMaterial);
            rightLowerDoor.position.set(2.4, 1.75, 1.1);
            rightLowerDoor.castShadow = true;
            doorGroup.add(rightLowerDoor);

            const rightUpperDoor = new THREE.Mesh(upperDoorGeometry, glassMaterial);
            rightUpperDoor.position.set(2.4, 3.15, 1.1);
            doorGroup.add(rightUpperDoor);
            // === Cửa trái dưới ===
            // Thân dưới
            const leftLowerDoor2 = new THREE.Mesh(lowerDoorGeometry, doorMaterial);
            leftLowerDoor2.position.set(-2.4, 1.75, -1.1);
            leftLowerDoor2.castShadow = true;
            doorGroup.add(leftLowerDoor2);

            // Kính trên
            const leftUpperDoor2 = new THREE.Mesh(upperDoorGeometry, glassMaterial);
            leftUpperDoor2.position.set(-2.4, 3.15, -1.1);
            doorGroup.add(leftUpperDoor2);

            // === Cửa phải dưới===
            const rightLowerDoor2 = new THREE.Mesh(lowerDoorGeometry, doorMaterial);
            rightLowerDoor2.position.set(2.4, 1.75, -1.1);
            rightLowerDoor2.castShadow = true;
            doorGroup.add(rightLowerDoor2);

            const rightUpperDoor2 = new THREE.Mesh(upperDoorGeometry, glassMaterial);
            rightUpperDoor2.position.set(2.4, 3.15, -1.1);
            doorGroup.add(rightUpperDoor2);

            car.add(doorGroup); // hoặc scene.add nếu muốn tách riêng
        }


    function createWheels() {
        const wheelGeometry = new THREE.CylinderGeometry(1, 1, 0.3, 16);
        const wheelMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });

        const barGeometry1 = new THREE.BoxGeometry(0.4, 1, 0.2);
        const barGeometry2 = new THREE.BoxGeometry(0.4, 0.2, 1);
        const barMaterial = new THREE.MeshPhongMaterial({ color: 0xffffff });

        const wheelPositions = [
            { x: -2.7, z: 3.8 },   // front-right
            { x: 2.7, z: 3.8 },    // front-left
            { x: -2.7, z: -3.2 },  // rear-right
            { x: 2.7, z: -3.2 }    // rear-left
        ];

        wheelPositions.forEach(pos => {
                    // Tạo nhóm bánh xe
                    const wheelGroup = new THREE.Group();

                    // Bánh xe tròn
                    const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
                    wheel.rotation.z = Math.PI / 2;
                    wheel.castShadow = true;
                    wheel.receiveShadow = true;
                    wheelGroup.add(wheel);

                    // Thanh ngang (dài theo Y)
                    const bar1 = new THREE.Mesh(barGeometry1, barMaterial);
                    bar1.castShadow = true;
                    bar1.receiveShadow = true;
                    wheelGroup.add(bar1);

                    // Thanh dọc (dài theo Z)
                    const bar2 = new THREE.Mesh(barGeometry2, barMaterial);
                    bar2.castShadow = true;
                    bar2.receiveShadow = true;
                    wheelGroup.add(bar2);

                    // Đặt vị trí cho nhóm bánh xe
                    wheelGroup.position.set(pos.x, 1, pos.z);

                    // Thêm nhóm vào xe
                    car.add(wheelGroup);
                });
    }


    function createMirrors() {

            // Gương trái

            // Gương phải

            // Gương chiếu hậu

    }

    function createHeadlights() {
            const headlightGeometry = new THREE.BoxGeometry(0.6, 0.4, 0.1);
            const headlightMaterial = new THREE.MeshPhongMaterial({ color: 0xffff00 }); // vàng

            const taillightGeometry = new THREE.BoxGeometry(0.3, 0.3, 0.1);
            const taillightMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 }); // đỏ

            // === Đèn pha (phía trước) ===
            const headlightLeft = new THREE.Mesh(headlightGeometry, headlightMaterial);
            headlightLeft.position.set(-1.2, 1.5, 6.6); // chỉnh tùy vào chiều dài xe bạn
            car.add(headlightLeft);

            const headlightRight = new THREE.Mesh(headlightGeometry, headlightMaterial);
            headlightRight.position.set(1.2, 1.5, 6.6);
            car.add(headlightRight);

            // === Đèn hậu (phía sau) ===
            const taillightLeft = new THREE.Mesh(taillightGeometry, taillightMaterial);
            taillightLeft.position.set(-1.2, 1.5, -5.8);
            car.add(taillightLeft);

            const taillightRight = new THREE.Mesh(taillightGeometry, taillightMaterial);
            taillightRight.position.set(1.2, 1.5, -5.8);
            car.add(taillightRight);
    }


   function createInterior() {
    const material = new THREE.MeshPhongMaterial({ color: 0xffffff });

    // Danh sách vị trí ghế
    const chairPositions = [
        { x: -1, z: 1 },   // front-right
        { x: 1, z: 1 },    // front-left
        { x: -1, z: -1.3 },  // rear-right
        { x: 1, z: -1.3 }    // rear-left
    ];

    chairPositions.forEach(pos => {
        const chair = new THREE.Group(); // Tạo ghế mới cho mỗi vị trí

        // Mặt ghế (ngang)
        const seatGeometry = new THREE.BoxGeometry(1.5, 0.8, 1.6);
        const seat = new THREE.Mesh(seatGeometry, material);
        seat.position.set(0, 0.5, 0); // vì cao 0.5 nên nâng lên 0.25
        chair.add(seat);

        // Lưng ghế (đứng)
        const backGeometry = new THREE.BoxGeometry(1.5, 2, 0.2);
        const back = new THREE.Mesh(backGeometry, material);
        back.position.set(0, 1.25, -0.7); // đứng lên từ mặt ghế
        chair.add(back);

        // Đặt vị trí toàn bộ ghế trong xe
        chair.position.set(pos.x, 1, pos.z);

        // Thêm vào xe hoặc scene
        car.add(chair); // hoặc scene.add(chair) nếu dùng ngoài xe
    });

        // Vô lăng
        const steeringGroup = new THREE.Group();
        const darkMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
        const whiteMaterial = new THREE.MeshPhongMaterial({ color: 0xffffff });

        // 1. Trục giữa (trụ đứng)
        const shaftGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.5, 16);
        const shaft = new THREE.Mesh(shaftGeometry, darkMaterial);
        shaft.position.set(0, 0.2, 0); // nối từ bảng điều khiển ra
        steeringGroup.add(shaft);

        // 2. Tay nắm chính (trụ dẹt, rộng hơn trục)
        const hubGeometry = new THREE.CylinderGeometry(0.2, 0.2, 0.1, 16);
        const hub = new THREE.Mesh(hubGeometry, whiteMaterial);
        hub.position.set(0, 0.5, 0); // đặt ở đầu trục
        steeringGroup.add(hub);

        // 3. 3 thanh nan nối từ tâm ra ngoài (dạng dấu sao)
        const spoke1 = new THREE.Mesh(
            new THREE.BoxGeometry(0.5, 0.05, 0.05),
            new THREE.MeshPhongMaterial({ color: 0xff0000 }) // đỏ
        );
        spoke1.position.set(Math.cos(0) * 0.25, 0.5, Math.sin(0) * 0.25); // nửa chiều dài
        spoke1.rotation.y = 0;
        steeringGroup.add(spoke1);

        // Thanh 2 – hướng 120 độ
        const angle2 = (120 * Math.PI) / 180;
        const spoke2 = new THREE.Mesh(
            new THREE.BoxGeometry(0.5, 0.05, 0.05),
            new THREE.MeshPhongMaterial({ color: 0x00ff00 }) // xanh lá
        );
        spoke2.position.set(Math.cos(angle2) * 0.25, 0.5, Math.sin(angle2) * 0.25);
        spoke2.rotation.y = -angle2;
        steeringGroup.add(spoke2);

        // Thanh 3 – hướng 240 độ
        const angle3 = (240 * Math.PI) / 180;
        const spoke3 = new THREE.Mesh(
            new THREE.BoxGeometry(0.5, 0.05, 0.05),
            new THREE.MeshPhongMaterial({ color: 0xffffff }) // xanh dương
        );
        spoke3.position.set(Math.cos(angle3) * 0.25, 0.5, Math.sin(angle3) * 0.25);
        spoke3.rotation.y = -angle3;
        steeringGroup.add(spoke3);

        // 4. Vành ngoài (vòng tròn rỗng)
        const torusGeometry = new THREE.TorusGeometry(0.5, 0.05, 16, 100);
        const torus = new THREE.Mesh(torusGeometry, darkMaterial);
        torus.rotation.x = Math.PI / 2;
        torus.position.y = 0.5;
        steeringGroup.add(torus);

        // Đặt vô lăng đúng vị trí trong xe nếu muốn
        steeringGroup.position.set(1, 2, 2.7); // điều chỉnh tùy xe bạn
        steeringGroup.rotation.x = -Math.PI / 3;
        car.add(steeringGroup); // hoặc scene.add nếu muốn test riêng
        // Bảng điều khiển
        const MornitorGeometry = new THREE.BoxGeometry(1.1, 0.6, 0.1);
        const Mornitor = new THREE.Mesh(MornitorGeometry, material);
        Mornitor.position.set(-0.1, 2.2, 2.5); // 
        Mornitor.rotation.x = Math.PI / 4;
        car.add(Mornitor);

}       

        function createWindshield() {
            
            // Kính chắn gió trước

            // Kính chắn gió sau

            // Kính bên

        }
        function createLicencePlate(){
            const LicencePlateGeometry = new THREE.BoxGeometry(1.7, 0.6, 0.1);
            const LicencePlate = new THREE.Mesh(LicencePlateGeometry, new THREE.MeshPhongMaterial({ color: 0xffffff }));
            LicencePlate.position.set(0, 1.5, -5.8); 
            car.add(LicencePlate);
        }

        function resetView() {
            camera.position.set(8, 6, 8);
            camera.lookAt(0, 0, 0);
        }

        function addEventListeners() {
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('wheel', onMouseWheel);
            window.addEventListener('resize', onWindowResize);
        }

        function onMouseDown(event) {
            isMouseDown = true;
            mouseX = event.clientX;
            mouseY = event.clientY;
        }

        function onMouseMove(event) {
            if (!isMouseDown) return;

            const deltaX = event.clientX - mouseX;
            const deltaY = event.clientY - mouseY;

            
                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);
                spherical.theta -= deltaX * 0.01;
                spherical.phi -= deltaY * 0.01;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);
            

            mouseX = event.clientX;
            mouseY = event.clientY;
        }

        function onMouseUp() {
            isMouseDown = false;
        }

        function onMouseWheel(event) {
            const distance = camera.position.distanceTo(new THREE.Vector3(0, 0, 0));
            const factor = event.deltaY > 0 ? 1.1 : 0.9;
            
            if (distance * factor > 2 && distance * factor < 50) {
                camera.position.multiplyScalar(factor);
            }
        }


        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            
            renderer.render(scene, camera);
        }

        // Khởi động ứng dụng
        init();
    </script>
</body>
</html>